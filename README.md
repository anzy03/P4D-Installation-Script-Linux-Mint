> **_NOTE:_**  This README and the .sh script have been generated by Gemini 2.0 Flash.

> It was made for Personal use. I have uploded it to Github for easy of access. If you don't like it don't use it.
> I have tested it and it works fine I was able to set up my server just fine.

> Feel Free to PR any fixes you find. **Thanks** 
 
# Perforce Helix Core Server Installation Script

This script automates the installation and configuration of a Perforce Helix Core server (P4D) on a fresh Linux Mint installation.

## Prerequisites

* A fresh installation of Linux Mint.
* `sudo` privileges.
* Internet connection.
* **Perforce Helix Core Server `.tar.gz` file.**

## Usage

1.  **Download Perforce Server Files:**
    * Go to the official Perforce Helix Core downloads page: [https://www.perforce.com/downloads/helix-core-p4d](https://www.perforce.com/downloads/helix-core-p4d)
    * Select the appropriate version and Linux distribution.
    * Download the `.tar.gz` file.
    * **Rename the downloaded file to `perforce-server.tgz` and place it in the same directory as this script.** If you want to use a different filename, change the `P4_TAR_GZ` variable in the script.
2.  **Download the Script:**
    * Save the script to a file (e.g., `install_perforce.sh`).
3.  **Make the Script Executable:**
    * Open a terminal and run: `chmod +x install_perforce.sh`
4.  **Run the Script with Root Privileges:**
    * Execute the script as root: `sudo ./install_perforce.sh`
5.  **Follow the Prompts:**
    * The script will prompt you for a Perforce username and password.

## Script Details

### Variables

* `P4_PORT`: The port on which the Perforce server will listen (default: 1666).
* `P4_ROOT`: The directory where the Perforce server data will be stored (default: `/opt/perforce`).
* `P4_USER`: The user under which the Perforce server will run (defaults to the current user).
* `IP_ADDRESS`: The IP address of the Linux Mint machine, automatically detected by the script.
* `P4_TAR_GZ`: The name of the Perforce server `.tar.gz` file (default: `perforce-server.tgz`).

### Functions

* `check_root()`: Checks if the script is run with root privileges.
* `extract_perforce()`: Extracts the Perforce server from the local `.tar.gz` file.
* `install_perforce()`: Installs the Perforce server by moving the `p4d` executable to `/usr/local/bin`.
* `configure_perforce()`:
    * Creates the `P4_ROOT` directory and sets ownership.
    * Sets the `P4ROOT` and `P4PORT` environment variables.
    * Initializes the Perforce server.
    * Prompts for and creates a Perforce user and sets the password.
    * Starts the Perforce server in the background.
    * Configures the `ufw` firewall to allow connections to the Perforce port.
* `create_systemd_service()`: Creates a systemd service file to automatically start the Perforce server on system boot.

### Output

* The script prints a message indicating successful installation and configuration.
* It displays the server address (`IP_ADDRESS:P4_PORT`).

## Important Notes

* **Manual Download:** The script now relies on a local `.tar.gz` file. Ensure you download the correct version from the official Perforce website and rename it to `perforce-server.tgz` (or modify the `P4_TAR_GZ` variable).
* **Firewall:** The script configures `ufw`. If you use a different firewall, you'll need to modify the script accordingly.
* **Security:** For production environments, implement proper security measures, including strong passwords, SSH key authentication, and firewall rules.
* **Backups:** Regularly back up the `P4_ROOT` directory to prevent data loss.
* **Network:** Ensure your network is properly configured and that the Perforce port is accessible.
* **Topology Warning:** If you see a topology warning after the server starts, you may need to set the ServerID. Please see the troubleshooting sections of the Perforce documentation.
* **SSH Tunneling:** For remote access, consider using SSH tunneling. This is more secure than port forwarding.
* **Tailscale/ZeroTier:** For simpler and secure remote access, consider using Tailscale or ZeroTier. These services create a virtual LAN and eliminate the need for port forwarding.

## Troubleshooting

* **Extraction Errors:** If the extraction fails, verify that the `.tar.gz` file is present and not corrupted.
* **Installation Errors:** If the installation fails, check the error messages and ensure that all dependencies are met.
* **Connection Errors:** If you cannot connect to the Perforce server, verify the server address, port, and firewall settings.
* **Topology Warning:** If you receive a topology warning, follow the instructions in the perforce documentation to set the server ID.
